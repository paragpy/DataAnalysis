Perfect! Here are the complete scripts for running your Django Graph API using **Gunicorn** instead of uWSGI:

## **Django Graph API with Gunicorn Scripts**

### **Step 1: Create Gunicorn Configuration**

```bash
nano /home/emerg1/app/gunicorn_config.py
```

```python
# Gunicorn configuration for Django Graph API
import multiprocessing

# Server socket
bind = "0.0.0.0:7000"
backlog = 2048

# Worker processes
workers = multiprocessing.cpu_count() * 2 + 1
worker_class = 'sync'
worker_connections = 1000
timeout = 300
keepalive = 5

# Restart workers after this many requests (prevents memory leaks)
max_requests = 1000
max_requests_jitter = 50

# Logging
accesslog = '/home/emerg1/app/logs/gunicorn_access.log'
errorlog = '/home/emerg1/app/logs/gunicorn_error.log'
loglevel = 'info'
access_log_format = '%(h)s %(l)s %(u)s %(t)s "%(r)s" %(s)s %(b)s "%(f)s" "%(a)s" %(D)s'

# Process naming
proc_name = 'django_graph_api'

# Server mechanics
daemon = False
preload_app = True
```

### **Step 2: Create Django Startup Script with Gunicorn**

```bash
nano /home/emerg1/app/start_django_gunicorn.sh
```

```bash
#!/bin/bash
set -e

echo "Starting Django Graph API with Gunicorn..."

# Navigate to Django app directory
cd /home/emerg1/app

# Activate virtual environment
source /home/emerg1/.venv/bin/activate

# Ensure logs directory exists
mkdir -p logs

# Export Django settings and Python path for graph_api
export DJANGO_SETTINGS_MODULE=graph_api.settings
export PYTHONPATH="/home/emerg1/app:$PYTHONPATH"

# Check if manage.py exists
if [ ! -f manage.py ]; then
    echo "Error: manage.py not found in /home/emerg1/app"
    exit 1
fi

# Check if Gunicorn is installed
if ! command -v gunicorn &> /dev/null; then
    echo "Installing Gunicorn..."
    pip install gunicorn
fi

# Run Django management commands
echo "Running Django migrations..."
python manage.py migrate --noinput

echo "Collecting static files..."
python manage.py collectstatic --noinput --clear

echo "Creating Django superuser (if needed)..."
python manage.py shell -c "
from django.contrib.auth import get_user_model
User = get_user_model()
if not User.objects.filter(username='admin').exists():
    User.objects.create_superuser('admin', 'admin@example.com', 'admin123')
    print('Superuser created: admin/admin123')
else:
    print('Superuser already exists')
" || true

# Start Django Graph API with Gunicorn using nohup
echo "Starting Django Graph API with Gunicorn..."
nohup gunicorn \
    --config gunicorn_config.py \
    graph_api.wsgi:application \
    > logs/django_startup.log 2>&1 &

# Get the PID
DJANGO_PID=$!
echo $DJANGO_PID > logs/django.pid

echo "================================"
echo "Django Graph API started successfully!"
echo "PID: $DJANGO_PID"
echo "URL: http://10.198.52.64:7000"
echo "Admin: http://10.198.52.64:7000/admin"
echo "API Docs: http://10.198.52.64:7000/api/"
echo "Graph API: http://10.198.52.64:7000/graph/"
echo "================================"
echo "Useful commands:"
echo "  View access logs: tail -f /home/emerg1/app/logs/gunicorn_access.log"
echo "  View error logs: tail -f /home/emerg1/app/logs/gunicorn_error.log"
echo "  Check process: ps aux | grep gunicorn"
echo "  Stop app: ./stop_django_gunicorn.sh"
echo "================================"
```

Make it executable:

```bash
chmod +x /home/emerg1/app/start_django_gunicorn.sh
```

### **Step 3: Create Django Stop Script**

```bash
nano /home/emerg1/app/stop_django_gunicorn.sh
```

```bash
#!/bin/bash

echo "Stopping Django Graph API (Gunicorn)..."

cd /home/emerg1/app

# Stop using PID file
if [ -f logs/django.pid ]; then
    PID=$(cat logs/django.pid)
    echo "Stopping Django Graph API (PID: $PID)..."
    
    # Try graceful shutdown first
    kill -TERM $PID 2>/dev/null || true
    sleep 5
    
    # Check if process is still running
    if ps -p $PID > /dev/null 2>&1; then
        echo "Process still running, force killing..."
        kill -KILL $PID 2>/dev/null || true
    fi
    
    rm logs/django.pid
    echo "Django Graph API stopped via PID."
else
    echo "No PID file found."
fi

# Also kill any Django gunicorn processes for this user
echo "Cleaning up any remaining gunicorn processes..."
pkill -f "gunicorn.*graph_api.wsgi" || true
pkill -f "gunicorn.*7000" || true

# Check if any processes are still running
REMAINING=$(ps aux | grep -E "(gunicorn.*7000|gunicorn.*graph_api.wsgi)" | grep -v grep | wc -l)
if [ $REMAINING -eq 0 ]; then
    echo "Django Graph API stopped successfully."
else
    echo "Warning: Some gunicorn processes may still be running."
    ps aux | grep -E "(gunicorn.*7000|gunicorn.*graph_api.wsgi)" | grep -v grep
fi
```

Make it executable:

```bash
chmod +x /home/emerg1/app/stop_django_gunicorn.sh
```

### **Step 4: Create Django Management Script**

```bash
nano /home/emerg1/app/manage_django_gunicorn.sh
```

```bash
#!/bin/bash

cd /home/emerg1/app
source /home/emerg1/.venv/bin/activate

# Set Django settings for graph_api
export DJANGO_SETTINGS_MODULE=graph_api.settings

case $1 in
    start)
        echo "Starting Django Graph API with Gunicorn..."
        ./start_django_gunicorn.sh
        ;;
    stop)
        echo "Stopping Django Graph API..."
        ./stop_django_gunicorn.sh
        ;;
    restart)
        echo "Restarting Django Graph API..."
        ./stop_django_gunicorn.sh
        sleep 3
        ./start_django_gunicorn.sh
        ;;
    reload)
        echo "Gracefully reloading Django Graph API..."
        if [ -f logs/django.pid ]; then
            PID=$(cat logs/django.pid)
            echo "Sending HUP signal to reload workers (PID: $PID)..."
            kill -HUP $PID 2>/dev/null || true
            echo "Reload signal sent."
        else
            echo "No PID file found. Use 'restart' instead."
        fi
        ;;
    status)
        echo "Django Graph API Status (Gunicorn):"
        if [ -f logs/django.pid ]; then
            PID=$(cat logs/django.pid)
            if ps -p $PID > /dev/null; then
                echo "✓ Running (PID: $PID)"
                echo "✓ URL: http://10.198.52.64:7000"
                
                # Show worker processes
                echo "✓ Worker processes:"
                ps aux | grep -E "(gunicorn.*graph_api.wsgi)" | grep -v grep
            else
                echo "✗ PID file exists but process not running"
            fi
        else
            echo "✗ Not running (no PID file)"
        fi
        
        # Check listening ports
        if netstat -tlnp 2>/dev/null | grep -q :7000; then
            echo "✓ Port 7000 is listening"
        else
            echo "✗ Port 7000 is not listening"
        fi
        ;;
    logs)
        echo "Viewing Django Graph API logs (Press Ctrl+C to exit):"
        echo "Choose log type:"
        echo "1) Error logs"
        echo "2) Access logs"
        echo "3) Both (split screen)"
        read -p "Enter choice (1-3): " choice
        
        case $choice in
            1)
                tail -f logs/gunicorn_error.log
                ;;
            2)
                tail -f logs/gunicorn_access.log
                ;;
            3)
                echo "Opening both logs..."
                tail -f logs/gunicorn_error.log logs/gunicorn_access.log
                ;;
            *)
                echo "Invalid choice. Showing error logs..."
                tail -f logs/gunicorn_error.log
                ;;
        esac
        ;;
    shell)
        echo "Opening Django shell..."
        python manage.py shell
        ;;
    migrate)
        echo "Running Django migrations..."
        python manage.py migrate
        ;;
    test)
        echo "Testing Django Graph API..."
        echo "Testing root endpoint:"
        curl -s -o /dev/null -w "HTTP %{http_code} - Response time: %{time_total}s\n" http://localhost:7000/
        
        echo "Testing admin endpoint:"
        curl -s -o /dev/null -w "HTTP %{http_code} - Response time: %{time_total}s\n" http://localhost:7000/admin/
        
        echo "Graph API test completed."
        ;;
    dbshell)
        echo "Opening Django database shell..."
        python manage.py dbshell
        ;;
    workers)
        echo "Gunicorn worker processes:"
        ps aux | grep -E "(gunicorn.*graph_api.wsgi)" | grep -v grep || echo "No workers found"
        ;;
    *)
        echo "Django Graph API Management Script (Gunicorn)"
        echo "Usage: $0 {start|stop|restart|reload|status|logs|shell|migrate|test|dbshell|workers}"
        echo ""
        echo "Commands:"
        echo "  start   - Start Django Graph API"
        echo "  stop    - Stop Django Graph API"
        echo "  restart - Restart Django Graph API"
        echo "  reload  - Gracefully reload workers (no downtime)"
        echo "  status  - Check if API is running"
        echo "  logs    - View real-time logs"
        echo "  shell   - Open Django shell"
        echo "  migrate - Run database migrations"
        echo "  test    - Test API endpoints"
        echo "  dbshell - Open database shell"
        echo "  workers - Show gunicorn worker processes"
        ;;
esac
```

Make it executable:

```bash
chmod +x /home/emerg1/app/manage_django_gunicorn.sh
```

### **Step 5: Create Setup Check Script for Gunicorn**

```bash
nano /home/emerg1/app/check_django_gunicorn_setup.sh
```

```bash
#!/bin/bash

echo "Checking Django Graph API setup for Gunicorn..."

cd /home/emerg1/app
source /home/emerg1/.venv/bin/activate

# Set Django settings
export DJANGO_SETTINGS_MODULE=graph_api.settings

# Check if Django is installed
echo "1. Checking Django installation..."
python -c "import django; print(f'Django version: {django.get_version()}')" || {
    echo "Django not found. Installing..."
    pip install django djangorestframework gunicorn
}

# Check if Gunicorn is installed
echo "2. Checking Gunicorn installation..."
python -c "import gunicorn; print(f'Gunicorn version: {gunicorn.__version__}')" || {
    echo "Gunicorn not found. Installing..."
    pip install gunicorn
}

# Check if manage.py exists
echo "3. Checking manage.py..."
if [ -f manage.py ]; then
    echo "✓ manage.py found"
else
    echo "✗ manage.py not found in /home/emerg1/app"
    exit 1
fi

# Check if graph_api directory exists
echo "4. Checking graph_api directory..."
if [ -d graph_api ]; then
    echo "✓ graph_api directory found"
    if [ -f graph_api/settings.py ]; then
        echo "✓ graph_api/settings.py found"
    else
        echo "✗ graph_api/settings.py not found"
        exit 1
    fi
    if [ -f graph_api/wsgi.py ]; then
        echo "✓ graph_api/wsgi.py found"
    else
        echo "✗ graph_api/wsgi.py not found"
        exit 1
    fi
else
    echo "✗ graph_api directory not found in /home/emerg1/app"
    exit 1
fi

# Test Gunicorn can load the application
echo "5. Testing Gunicorn can load the application..."
gunicorn --check-config --config gunicorn_config.py graph_api.wsgi:application || {
    echo "Warning: Gunicorn config check failed, but continuing..."
}

# Check Django settings
echo "6. Checking Django settings..."
python manage.py check --deploy || {
    echo "Django check failed. Continuing anyway..."
}

# Check database
echo "7. Checking database..."
python -c "
import django
django.setup()
from django.db import connection
print(f'Database: {connection.settings_dict[\"ENGINE\"]}')
" || echo "Database check failed, but continuing..."

echo "✓ Django Graph API with Gunicorn setup check completed!"
echo ""
echo "Ready to start with: ./manage_django_gunicorn.sh start"
```

Make it executable:

```bash
chmod +x /home/emerg1/app/check_django_gunicorn_setup.sh
```

## **Usage Instructions**

### **Step 1: Setup and Check Environment**

```bash
cd /home/emerg1/app

# Check setup
./check_django_gunicorn_setup.sh

# Install Gunicorn if needed
source /home/emerg1/.venv/bin/activate
pip install gunicorn
```

### **Step 2: Start Django Graph API**

```bash
# Start the API
./manage_django_gunicorn.sh start

# Check status
./manage_django_gunicorn.sh status
```

### **Step 3: Test the API**

```bash
# Test endpoints
./manage_django_gunicorn.sh test

# View logs
./manage_django_gunicorn.sh logs

# Check worker processes
./manage_django_gunicorn.sh workers
```

### **Step 4: Manage the API**

```bash
# Graceful reload (no downtime)
./manage_django_gunicorn.sh reload

# Full restart
./manage_django_gunicorn.sh restart

# Stop
./manage_django_gunicorn.sh stop
```

## **Firewall Configuration**

```bash
# Open port 7000
sudo firewall-cmd --add-port=7000/tcp --permanent
sudo firewall-cmd --reload
```

## **Advantages of Gunicorn over uWSGI**

✅ **Simpler configuration** - Less complex than uWSGI  
✅ **Better Django integration** - Built specifically for WSGI apps  
✅ **Graceful reloading** - Zero-downtime deployments with `reload` command  
✅ **Better process management** - Master/worker architecture  
✅ **Easier debugging** - Clearer error messages

Your Django Graph API will now run on **http://10.198.52.64:7000** using Gunicorn!​​​​​​​​​​​​​​​​